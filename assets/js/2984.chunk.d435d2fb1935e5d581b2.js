"use strict";(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[2984],{2984:(t,e,i)=>{i.d(e,{FormManager:()=>o});var r=i(9754),s=i(6110);const n='[data-honey], [name="honey"]';class o{constructor(t,e={}){if(this.$form="string"==typeof t?document.querySelector(t):t,!this.$form)throw new Error(`FormManager: Form not found: ${t}`);this.config={autoReady:!0,initialState:"ready",allowResubmit:!0,resetOnSuccess:!1,warnOnUnsavedChanges:!1,submittingText:"Processing...",submittedText:"Processed!",inputGroup:null,...e},this.state="initializing",this._isDirty=!1,this._listeners={change:[],validation:[],submit:[],statechange:[],honeypot:[]},this._fieldErrors={},this._beforeUnloadHandler=t=>this._handleBeforeUnload(t),this._init()}_init(){this._setDisabled(!0),this.$form.addEventListener("submit",t=>this._handleSubmit(t)),this.$form.addEventListener("input",t=>this._handleChange(t)),this.$form.addEventListener("change",t=>this._handleChange(t)),this.config.warnOnUnsavedChanges&&window.addEventListener("beforeunload",this._beforeUnloadHandler),window.addEventListener("pageshow",t=>this._handlePageShow(t)),this.config.autoReady&&(0,r.ready)().then(()=>this._setInitialState())}on(t,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),this}async _emit(t,e){const i=this._listeners[t]||[];for(const t of i)await t(e)}_setInitialState(){const t=this.config.initialState;"ready"===t?this.ready():this._setState(t)}ready(){this._setState("ready"),this._setDisabled(!1);const t=this.$form.querySelector("[autofocus]");t&&!t.disabled&&"desktop"===(0,s.getDeviceType)()&&t.focus()}async _handleSubmit(t){if(t.preventDefault(),"ready"!==this.state)return;const e=t.submitter,i=this.getData();if(this.clearFieldErrors(),await this._runValidation(i,e)){this._setState("submitting"),this._setDisabled(!0),this._showSpinner(!0);try{await this._emit("submit",{data:i,$submitButton:e}),this.setDirty(!1),this._showSpinner(!1),this.config.resetOnSuccess&&this.$form.reset(),this.config.allowResubmit?(this._setState("ready"),this._setDisabled(!1)):(this._setState("submitted"),this._showSubmittedText())}catch(t){this._setState("ready"),this._setDisabled(!1),this._showSpinner(!1),this.showError(t.message||"An error occurred")}}}_handleChange(t){this.setDirty(!0);const e=this.getData();this._emit("change",{field:t.target,name:t.target.name,value:t.target.value,data:e}),this._fieldErrors[t.target.name]&&this._clearFieldError(t.target.name)}async _runValidation(t,e){if(this._isHoneypotFilled())return this._emit("honeypot",{data:t}),this.showError("Something went wrong. Please try again."),!1;const i=(t,e)=>{this._fieldErrors[t]=e};return this._runHTML5Validation(i),await this._emit("validation",{data:t,setError:i,$submitButton:e}),!(Object.keys(this._fieldErrors).length>0&&(this._displayFieldErrors(),this._focusFirstError(),1))}_runHTML5Validation(t){this.$form.querySelectorAll("input, select, textarea").forEach(e=>{const i=e.name;if(!i)return;if(!this._isFieldInGroup(e))return;if(this._fieldErrors[i])return;const r=e.value,s=e.type;if(e.hasAttribute("required")){if("checkbox"===s&&!e.checked)return void t(i,"This field is required");if(!r||!r.trim())return void t(i,"This field is required")}if(r){if("email"===s&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r))return void t(i,"Please enter a valid email address");if("url"===s)try{new URL(r)}catch{return void t(i,"Please enter a valid URL")}if(e.hasAttribute("minlength")){const s=parseInt(e.getAttribute("minlength"),10);if(r.length<s)return void t(i,`Must be at least ${s} characters`)}if(e.hasAttribute("maxlength")){const s=parseInt(e.getAttribute("maxlength"),10);if(r.length>s)return void t(i,`Must be no more than ${s} characters`)}if(e.hasAttribute("min")){const n=e.getAttribute("min");if("number"===s||"range"===s){if(parseFloat(r)<parseFloat(n))return void t(i,`Must be at least ${n}`)}else if(("date"===s||"datetime-local"===s)&&new Date(r)<new Date(n))return void t(i,`Must be on or after ${n}`)}if(e.hasAttribute("max")){const n=e.getAttribute("max");if("number"===s||"range"===s){if(parseFloat(r)>parseFloat(n))return void t(i,`Must be no more than ${n}`)}else if(("date"===s||"datetime-local"===s)&&new Date(r)>new Date(n))return void t(i,`Must be on or before ${n}`)}if(e.hasAttribute("pattern")&&!new RegExp(`^${e.getAttribute("pattern")}$`).test(r)){const r=e.getAttribute("title")||"Please match the requested format";return void t(i,r)}}})}_displayFieldErrors(){for(const[t,e]of Object.entries(this._fieldErrors))this._showFieldError(t,e)}_showFieldError(t,e){const i=this.$form.querySelector(`[name="${t}"]`);if(!i)return;i.classList.add("is-invalid");let r=i.parentElement.querySelector(".invalid-feedback");r||(r=document.createElement("div"),r.className="invalid-feedback","checkbox"===i.type||"radio"===i.type?(i.closest(".form-check")||i.parentElement).appendChild(r):i.parentElement.appendChild(r)),r.textContent=e,r.style.display="block"}_clearFieldError(t){delete this._fieldErrors[t];const e=this.$form.querySelector(`[name="${t}"]`);if(!e)return;e.classList.remove("is-invalid");const i=e.parentElement.querySelector(".invalid-feedback");i&&(i.style.display="none")}clearFieldErrors(){for(const t of Object.keys(this._fieldErrors))this._clearFieldError(t);this._fieldErrors={}}_focusFirstError(){const t=Object.keys(this._fieldErrors)[0];if(!t)return;const e=this.$form.querySelector(`[name="${t}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus())}throwFieldErrors(t){for(const[e,i]of Object.entries(t))this._fieldErrors[e]=i;throw this._displayFieldErrors(),this._focusFirstError(),new Error("Validation failed")}_handleBeforeUnload(t){this._isDirty&&(t.preventDefault(),t.returnValue="")}_handlePageShow(t){t.persisted&&"submitting"===this.state&&(this._showSpinner(!1),this.ready())}setDirty(t){this._isDirty!==t&&(this._isDirty=t)}_setState(t){const e=this.state;this.state=t,this.$form.setAttribute("data-form-state",t),this._emit("statechange",{state:t,previousState:e})}_setDisabled(t){this.$form.querySelectorAll("button, input, select, textarea").forEach(e=>{e.disabled=t})}_getSubmitButtons(){return Array.from(this.$form.querySelectorAll("button")).filter(t=>"submit"===t.type)}_showSpinner(t){this._getSubmitButtons().forEach(e=>{t?(e._originalHTML=e.innerHTML,e.innerHTML=`<span class="spinner-border spinner-border-sm me-2"></span>${this.config.submittingText}`):e._originalHTML&&(e.innerHTML=e._originalHTML)})}_showSubmittedText(){this._getSubmitButtons().forEach(t=>{const e=t.querySelector(".button-text");e?e.textContent=this.config.submittedText:t.textContent=this.config.submittedText})}_setNested(t,e,i){const r=e.split("."),s=r.pop();let n=t;for(const t of r)n[t]&&"object"==typeof n[t]||(n[t]={}),n=n[t];void 0!==n[s]?(Array.isArray(n[s])||(n[s]=[n[s]]),n[s].push(i)):n[s]=i}_getNested(t,e){return e.split(".").reduce((t,e)=>t&&void 0!==t[e]?t[e]:void 0,t)}getData(){const t={},e=this.$form.querySelectorAll("input, select, textarea"),i={};e.forEach(t=>{"checkbox"===t.type&&this._isFieldInGroup(t)&&(i[t.name]=(i[t.name]||0)+1)}),e.forEach(e=>{const i=e.name;i&&this._isFieldInGroup(e)&&(e.matches(n)||"checkbox"!==e.type&&("radio"!==e.type||e.checked)&&this._setNested(t,i,e.value))});const r=new Set;return e.forEach(e=>{if("checkbox"!==e.type)return;const s=e.name;if(!this._isFieldInGroup(e))return;if(1===i[s])return void this._setNested(t,s,e.checked);if(r.has(s))return;r.add(s);const n={};this.$form.querySelectorAll(`input[type="checkbox"][name="${s}"]`).forEach(t=>{this._isFieldInGroup(t)&&(n[t.value]=t.checked)}),this._setNested(t,s,n)}),t}showSuccess(t){(0,s.showNotification)(t,{type:"success"})}showError(t){(0,s.showNotification)(t,{type:"danger"})}reset(){this.setDirty(!1),this.$form.reset(),this._setState("ready")}isDirty(){return this._isDirty}setInputGroup(t){return null==t||""===t?this.config.inputGroup=null:Array.isArray(t)?this.config.inputGroup=t.map(t=>t.toLowerCase()):this.config.inputGroup=[t.toLowerCase()],this}getInputGroup(){return this.config.inputGroup}_isHoneypotFilled(){const t=this.$form.querySelectorAll(n);for(const e of t)if(e.value&&""!==e.value.trim())return!0;return!1}_isFieldInGroup(t){const e=this.config.inputGroup;if(!e)return!0;const i=t.getAttribute("data-input-group");return!i||""===i.trim()||e.includes(i.toLowerCase())}setData(t){const e=this._flattenObject(t);for(const[t,i]of Object.entries(e))this._setFieldValue(t,i)}_flattenObject(t,e=""){const i={};for(const[r,s]of Object.entries(t)){const t=e?`${e}.${r}`:r;null===s||"object"!=typeof s||Array.isArray(s)||Object.values(s).every(t=>"boolean"==typeof t)?i[t]=s:Object.assign(i,this._flattenObject(s,t))}return i}_setFieldValue(t,e){const i=this.$form.querySelectorAll(`[name="${t}"]`);if(0===i.length)return;const r=i[0],s=r.type;"checkbox"===s?1===i.length?r.checked=!!e:"object"==typeof e&&i.forEach(t=>{t.checked=!!e[t.value]}):"radio"===s?i.forEach(t=>{t.checked=t.value===e}):(r.tagName,r.value=e)}}}}]);